<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_ux_client_script">
    <sys_ux_client_script action="INSERT_OR_UPDATE">
        <includes>59b6dc70db5e0510f7265eea4b96195a</includes>
        <macroponent display_value="Simple List Oferta">43c576e9db520910f7265eea4b96196b</macroponent>
        <name>Actualizar Filtros Menú y Tabla Ofertas</name>
        <required_translations>[ ]</required_translations>
        <script><![CDATA[/**
 * @param {params} params
 * @param {api} params.api
 * @param {any} params.event
 * @param {any} params.imports
 * @param {ApiHelpers} params.helpers
 */
function handler({
    api,
    event,
    helpers,
    imports
}) {
    try {
        const {
            context,
            data,
            state,
            setState,
            emit
        } = api;
        //     let itemCliente;
        //     if(event.payload.item.tabla='cliente'){
        // itemCliente+=itemCliente+event.payload.item.id;
        //     }
        const {
            filtrosPayload
        } = event;

        let queryURL = "";

        var idsAreas = "";
        var idsClientes = "";
        var idsAnios = "";
        var idsMercados = "";
        var idsFabricantes = "";
        var idsHerramientas = "";
        var idsEstados = "";
        var idsPaises = "";

        var menuFiltroObj = {};
        var menuFiltro = [];

        var defaultFiltros = "";

        const {
            getFiltro
        } = imports['x_issas_gesti_n_0.ObtenerFiltrosInclude']();

        //defaultFiltros = "anio_oferta.IN2019^";
        queryURL += defaultFiltros !== "" ? defaultFiltros : "";

        if (filtrosPayload) {
            console.log("filtrosPayload", filtrosPayload);
            idsAreas = getFiltro(filtrosPayload, 'area_funcional');
            queryURL += idsAreas !== "" ? "area_funcional.CONTAINS" + idsAreas + "^" : "";
            idsClientes = getFiltro(filtrosPayload, 'cliente');
            queryURL += idsClientes !== "" ? "cliente.sys_idIN" + idsClientes + "^" : "";
            idsAnios = getFiltro(filtrosPayload, 'anio_oferta');
            queryURL += idsAnios !== "" ? "anio_oferta.IN" + idsAnios + "^" : "";
            idsFabricantes = getFiltro(filtrosPayload, 'fabricante');
            queryURL += idsFabricantes !== "" ? "herramienta.fabricanteIN" + idsFabricantes + "^" : "";
            idsHerramientas = getFiltro(filtrosPayload, 'herramienta');
            queryURL += idsHerramientas !== "" ? "herramientaIN" + idsHerramientas + "^" : "";
            idsMercados = getFiltro(filtrosPayload, 'mercado');
            queryURL += idsMercados !== "" ? "mercado.sys_idIN" + idsMercados + "^" : "";
            idsEstados = getFiltro(filtrosPayload, 'estado');
            queryURL += idsEstados !== "" ? "estado.IN" + idsEstados + "^" : "";
        }

        console.log('queryURL', queryURL);
        setState('ofertasMenuFiltrosSeleccionados', queryURL);

        helpers.snHttp('/api/x_issas_gesti_n_0/gestion_oportunidades_api/putMenuFiltrosOferta', {
            method: 'PUT',
            body: {
                filtros: filtrosPayload
            },
            headers: {
                "Content-Type": "application/json"
            }
        })
        .then(({
            response
        }) => {
            menuFiltroObj = response.result[0];
            menuFiltro = [menuFiltroObj];
            api.setState('ofertasMenuFiltros', menuFiltro);
        })
        .catch(({
            error
        }) => {
            const message = `Error: ${error.data.error.message}`;
            console.error(message);
            api.emit('NOW_UXF_PAGE#ADD_NOTIFICATIONS', {
                id: 'alert5',
                status: 'high',
                icon: 'info-circle-outline',
                content: message,
                action: {
                    type: 'dismiss'
                }
            });
        });
    } catch (e) {
        debugger;
    }
}]]></script>
        <script_api_version>2.0.0</script_api_version>
        <sys_class_name>sys_ux_client_script</sys_class_name>
        <sys_created_by>idramirez</sys_created_by>
        <sys_created_on>2022-03-17 21:09:32</sys_created_on>
        <sys_id>2fc576e9db520910f7265eea4b9619aa</sys_id>
        <sys_mod_count>31</sys_mod_count>
        <sys_name>Actualizar Filtros Menú y Tabla Ofertas</sys_name>
        <sys_package display_value="Gestión de Oportunidades" source="x_issas_gesti_n_0">e6fcd7aedb86c110f7265eea4b961914</sys_package>
        <sys_policy/>
        <sys_scope display_value="Gestión de Oportunidades">e6fcd7aedb86c110f7265eea4b961914</sys_scope>
        <sys_update_name>sys_ux_client_script_2fc576e9db520910f7265eea4b9619aa</sys_update_name>
        <sys_updated_by>semartinez</sys_updated_by>
        <sys_updated_on>2022-04-25 15:05:06</sys_updated_on>
    </sys_ux_client_script>
</record_update>
